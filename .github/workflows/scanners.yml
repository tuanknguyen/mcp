name: Scanners

on:
  push:
  pull_request:
  workflow_dispatch:

permissions: {}

jobs:

  secrets-scanner:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
    - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 #v6.0.1
    - uses: actions/setup-python@83679a892e2d95755f2dac6acb0bfd1e9ac5d548 #v6.1.0
      with:
        python-version: '3'
    - run: |
        pip install --require-hashes --requirement .github/workflows/detect-secrets-requirements.txt
    - name: detect-secrets
      id: detect-secrets
      run: | # pragma: allowlist secret
        detect-secrets scan --baseline .secrets.baseline
        cat .secrets.baseline | jq '[.results|to_entries|.[].value[]|{ "filename": .filename, "is_secret": .is_secret } | if .is_secret == null or .is_secret == true then .filename else empty end]|unique|if length>0 then error("potential secrets in: \(.)") else empty end'
